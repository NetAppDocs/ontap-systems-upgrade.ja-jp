---
sidebar: sidebar 
permalink: upgrade-arl-manual/arl_upgrade_workflow.html 
keywords: upgrade workflow, procedure steps, stages 
summary: ONTAP 9.7 以前を実行するコントローラペアの ARL の手動アップグレード手順 の仕組みを理解する。 
---
= ARL のアップグレードワークフロー
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ARL を使用してノードをアップグレードする前に、手順の動作について理解しておく必要があります。このドキュメントでは、手順をいくつかの段階に分けて説明します。



== ノードペアをアップグレードします

ノードペアをアップグレードするには、元のノードを準備し、元のノードと新しいノードの両方で一連の手順を実行する必要があります。その後、元のノードの運用を停止できます。



== ARL アップグレードシーケンスの概要

手順では、交換用コントローラハードウェアを使用して元のコントローラハードウェアを一度に 1 台ずつアップグレードし、 HA ペア構成を利用してルート以外のアグリゲートの所有権を切り替えます。すべてのルート以外のアグリゲートで、アップグレード後の正しいノードである最終デスティネーションに到達するために、 2 つの再配置を実行する必要があります。

各アグリゲートにはホーム所有者と現在の所有者があります。ホーム所有者はアグリゲートの実際の所有者であり、現在の所有者は一時的な所有者です。

次の図は、手順の各ステージを示しています。濃い薄いグレーの矢印はアグリゲートの再配置と LIF の移動を表し、薄い黒い矢印は元のノードの削除を表します。元のノードは小規模なコントローライメージで表しており、大規模なコントローライメージが新しいノードを表しています。

image:arl_upgrade_manual_image1.PNG["ARL 手順の各ステージを示す図"]

次の表に、各フェーズで実行するタスクの概要と、そのフェーズの最後で実行したアグリゲートの所有権の状態を示します。詳細な手順については、手順の後半で説明します。

[cols="35,65"]
|===
| 段階 | 説明 


| link:determine_aggregates_on_internal_drives.html["ステージ 1 ：アップグレードの準備"]  a| 
ステージ1で必要に応じて、内部ディスクドライブにルートアグリゲートまたはデータアグリゲートが含まれていないことを確認し、ノードをアップグレードの準備をしてから、一連の事前確認を実行します。必要に応じて、ストレージ暗号化のためにディスクのキーを変更し、新しいコントローラをネットブートする準備を行います。

ステージ 1 終了時のアグリゲートの所有権：

* node1 は、 node1 アグリゲートのホーム所有者と現在の所有者です。
* node2 には、 node2 アグリゲートのホーム所有者と現在の所有者を指定します。




| link:relocate_non_root_aggr_node1_node2.html["ステージ 2 ： node1 を廃棄する"]  a| 
ステージ2で、ルート以外のアグリゲートをノード1からノード2に再配置し、ノード1が所有するSAN以外のデータLIFを、障害アグリゲートまたは拒否アグリゲートを含めてノード2に移動します。手順 の後半で使用するために必要なノード1の情報を記録し、ノード1を撤去します。

ステージ 2 終了時のアグリゲートの所有権：

* node1 は、 node1 アグリゲートのホーム所有者です。
* node2 には、 node1 アグリゲートの現在の所有者を指定します。
* node2 には、 node2 アグリゲートのホーム所有者と現在の所有者を指定します。




| link:install_boot_node3.html["ステージ 3 ：ノード 3 をインストールしてブートします"]  a| 
ステージ 3 で、ノード 3 をインストールしてブートし、クラスタポートとノード管理ポートをノード 1 からノード 3 にマッピングし、ノード 3 のインストールを確認して、ノード 1 に属するデータ LIF と SAN LIF をノード 2 からノード 3 に移動します。また、すべてのアグリゲートをnode2からnode3に再配置し、node2によって所有されているデータLIFとSAN LIFをnode3に移動します。

ステージ 3 終了時のアグリゲートの所有権：

* node2 は node2 アグリゲートのホーム所有者ですが、現在の所有者ではありません。
* node3 は、 node1 にもともと属していたアグリゲートのホーム所有者および現在の所有者です。
* node2 には、ホームの所有者とホームの所有者ではなく、 node2 に属するアグリゲートの現在の所有者が指定されます。




| link:record_node2_information.html["ステージ 4 ： node2 を廃棄する"]  a| 
ステージ4で、あとで手順 で使用するために必要なnode2の情報を記録し、node2を撤去します。

アグリゲートの所有権は変更されません。



| link:install_boot_node4.html["ステージ 5 ：ノード 4 をインストールしてブートします"]  a| 
ステージ5で、node4のインストールとブートの際には、クラスタポートとノード管理ポートをnode2からnode4にマッピングし、node4のインストールを確認して、node2に属するデータLIFとSAN LIFをnode3からnode4に移動します。node2のアグリゲートをnode3からnode4に再配置し、ノード2のNAS LIFをnode3からnode4に移動します。

ステージ 5 終了時のアグリゲートの所有権：

* node3 は、 node1 に属していたアグリゲートのホーム所有者および現在の所有者です。
* node4 は、 node2 に属していたアグリゲートのホーム所有者および現在の所有者です。




| link:manage_authentication_kmip.html["ステージ 6 ：アップグレードを完了する"]  a| 
ステージ6では、新しいノードが正しくセットアップされていることを確認し、新しいノードで暗号化が有効になっている場合はストレージ暗号化またはNetApp Volume Encryptionをセットアップします。また、古いノードの運用を停止し、SnapMirror処理を再開する必要があります。


NOTE: Storage Virtual Machine（SVM）ディザスタリカバリの更新は、割り当てられたスケジュールどおりに中断されません。

アグリゲートの所有権は変更されません。

|===