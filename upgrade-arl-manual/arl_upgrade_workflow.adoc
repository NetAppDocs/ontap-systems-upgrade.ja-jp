---
sidebar: sidebar 
permalink: upgrade-arl-manual/arl_upgrade_workflow.html 
keywords: upgrade workflow, procedure steps, stages 
summary: ONTAP 9.7 以前を実行するコントローラペアの ARL の手動アップグレード手順 の仕組みを理解する。 
---
= ARL のアップグレードワークフロー
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
ARL を使用してノードをアップグレードする前に、手順の動作について理解しておく必要があります。このドキュメントでは、手順をいくつかの段階に分けて説明します。



== ノードペアをアップグレードします

ノードペアをアップグレードするには、元のノードを準備し、元のノードと新しいノードの両方で一連の手順を実行する必要があります。その後、元のノードの運用を停止できます。



== ARL アップグレードシーケンスの概要

手順では、交換用コントローラハードウェアを使用して元のコントローラハードウェアを一度に 1 台ずつアップグレードし、 HA ペア構成を利用してルート以外のアグリゲートの所有権を切り替えます。すべてのルート以外のアグリゲートで、アップグレード後の正しいノードである最終デスティネーションに到達するために、 2 つの再配置を実行する必要があります。

各アグリゲートにはホーム所有者と現在の所有者があります。ホーム所有者はアグリゲートの実際の所有者であり、現在の所有者は一時的な所有者です。

次の図は、手順の各ステージを示しています。濃い薄いグレーの矢印はアグリゲートの再配置と LIF の移動を表し、薄い黒い矢印は元のノードの削除を表します。元のノードは小規模なコントローライメージで表しており、大規模なコントローライメージが新しいノードを表しています。

image:arl_upgrade_manual_image1.PNG["ARL 手順の各ステージを示す図"]

次の表に、各フェーズで実行するタスクの概要と、そのフェーズの最後で実行したアグリゲートの所有権の状態を示します。詳細な手順については、手順の後半で説明します。

[cols="35,65"]
|===
| 段階 | 手順 


| link:stage_1_index.html["ステージ 1 ：アップグレードの準備"]  a| 
. コントローラの内蔵ディスクドライブにアグリゲートがあるかどうかを確認します。
+
この手順は、内蔵ディスクドライブを搭載したコントローラからアップグレードする場合にのみ必要です。

. ノードをアップグレードする準備をします
. ストレージ暗号化のためにディスクのキーを変更して
+
このタスクを実行する必要があるのは、自己暗号化ドライブが搭載されたシステムからアップグレードする場合のみです。

. クラスタの SnapMirror 関係の状態を確認し、クラスタ間のすべての関係を休止します。
. ネットブートを準備


ステージ 1 終了時のアグリゲートの所有権：

* node1 は、 node1 アグリゲートのホーム所有者と現在の所有者です。
* node2 には、 node2 アグリゲートのホーム所有者と現在の所有者を指定します。




| link:stage_2_index.html["ステージ 2 ： node1 を廃棄する"]  a| 
. ルート以外のアグリゲートを node1 から node2 に再配置します。
. node1 で所有されている SAN 以外のデータ LIFS を node2 に移動します。
. ノード 1 の情報を記録します
. 障害が発生したアグリゲートを再配置するか、
. ノード 1 を撤去


ステージ 2 終了時のアグリゲートの所有権：

* node1 は、 node1 アグリゲートのホーム所有者です。
* node2 には、 node1 アグリゲートの現在の所有者を指定します。
* node2 には、 node2 アグリゲートのホーム所有者と現在の所有者を指定します。




| link:stage_3_index.html["ステージ 3 ：ノード 3 をインストールしてブートします"]  a| 
. node3 をインストールしてブートします。
. ノード 3 で UTA / UTA2 設定を設定します。
. ポートを node1 から node3 にマッピングします
. ノード 3 のインストールを確認します
. node1 で所有されている SAN 以外のデータ LIF を node2 から node3 に移動し、 node3 の SNA LIF を確認します。
. ルート以外のアグリゲートを node2 から node3 に再配置します。
. node2 によって所有されている SAN 以外のデータ LIF を node3 に移動します。


ステージ 3 終了時のアグリゲートの所有権：

* node2 は node2 アグリゲートのホーム所有者ですが、現在の所有者ではありません。
* node3 は、 node1 にもともと属していたアグリゲートのホーム所有者および現在の所有者です。
* node2 には、ホームの所有者とホームの所有者ではなく、 node2 に属するアグリゲートの現在の所有者が指定されます。




| link:stage_4_index.html["ステージ 4 ： node2 を廃棄する"]  a| 
. ノード 2 の情報を記録します。
. ノード 2 を撤去


アグリゲートの所有権は変更されません。



| link:stage_5_index.html["ステージ 5 ：ノード 4 をインストールしてブートします"]  a| 
. ノード 4 をインストールしてブートします。
. ノード 4 で UTA / UTA2 設定を設定します。
. node2 のポートを node4 にマッピングします
. ノード 4 が正常にインストールされていることを確認
. node2 によって所有されている SAN 以外のデータ LIF を node3 から node4 に移動し、 node4 にある SNA LIF を確認します。
. ノード 2 のルート以外のアグリゲートをノード 3 からノード 4 に再配置します。


ステージ 5 終了時のアグリゲートの所有権：

* node3 は、 node1 に属していたアグリゲートのホーム所有者および現在の所有者です。
* node4 は、 node2 に属していたアグリゲートのホーム所有者および現在の所有者です。




| link:stage_6_index.html["ステージ 6 ：アップグレードを完了する"]  a| 
. 新しいコントローラが正しくセットアップされていることを確認する。
. 新しいノードで Storage Encryption をセットアップします。
+
このタスクを実行する必要があるのは、自己暗号化ドライブを搭載したシステムにアップグレードする場合のみです。

. 古いシステムの運用を停止
. NetApp SnapMirror 関係を再開
+
* 注： * Storage Virtual Machine （ SVM ）ディザスタリカバリの更新は、割り当てられたスケジュールどおりに中断されません。



アグリゲートの所有権は変更されません。

|===